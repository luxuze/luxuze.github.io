# 缓存

## 缓存穿透

产生这个问题的原因可能是外部的恶意攻击，例如，对用户信息进行了缓存，但恶意攻击者使用不存在的用户id频繁请求接口，导致查询缓存不命中，然后穿透 DB 查询依然不命中。这时会有大量请求穿透缓存访问到 DB。

解决的办法:

- 对不存在的用户，在缓存中保存一个空对象进行标记，防止相同 ID 再次访问 DB。不过有时这个方法并不能很好解决问题，可能导致缓存中存储大量无用数据。
- 使用 BloomFilter 过滤器，BloomFilter 的特点是存在性检测，如果 BloomFilter 中不存在，那么数据一定不存在；如果 BloomFilter 中存在，实际数据也有可能会不存在。非常适合解决这类的问题。

## 缓存击穿

某个热点数据失效时，大量针对这个数据的请求会穿透到数据源。

解决办法:

- 可以使用互斥锁更新，保证同一个进程中针对同一个数据不会并发请求到 DB，减小 DB 压力。
- 使用随机退避方式，失效时随机 sleep 一个很短的时间，再次查询，如果失败再执行更新。
- 针对多个热点 key 同时失效的问题，可以在缓存时使用固定时间加上一个小的随机数，避免大量热点 key 同一时刻失效。

## 缓存雪崩

产生的原因是缓存挂掉，这时所有的请求都会穿透到 DB。

解决方法：

- 使用快速失败的熔断策略，减少 DB 瞬间压力；
- 使用主从模式和集群模式来尽量保证缓存服务的高可用。
- 实际场景中，这两种方法会结合使用。
